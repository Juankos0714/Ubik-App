server:
  port: 8080

spring:
  cloud:
    gateway:
      routes:
        # ═══════════════════════════════════════════════════════
        # MOTEL MANAGEMENT - RUTAS AUTENTICADAS
        # ⚠️  DEBEN IR ANTES que /api/auth/** del userManagement
        # ═══════════════════════════════════════════════════════

        # 1️⃣ PRIMERO: ruta exacta, sin variables (más específica)
        - id: motel-management-my-motels
          uri: http://motel-management-service:8083
          predicates:
            - Path=/api/auth/motels/my-motels
          filters:
            - StripPrefix=0

        # 2️⃣ SEGUNDO: ruta con variable de path (menos específica)
        - id: motel-management-auth-motels-userid
          uri: http://motel-management-service:8083
          predicates:
            - Path=/api/auth/motels/{userId}
          filters:
            - StripPrefix=0

        # ═══════════════════════════════════════════════════════
        # USER MANAGEMENT
        # Debe ir DESPUÉS de las rutas de motel autenticadas
        # ═══════════════════════════════════════════════════════

        # 3️⃣ Auth general (login, registro, etc.)
        - id: userManagement-auth
          uri: http://usermanagement-service:8081
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=0

        # 4️⃣ Profile
        - id: userManagement-profile
          uri: http://usermanagement-service:8081
          predicates:
            - Path=/api/user/**
          filters:
            - StripPrefix=0

        # ═══════════════════════════════════════════════════════
        # OTROS SERVICIOS
        # ═══════════════════════════════════════════════════════

        # 5️⃣ Notifications
        - id: notificationService
          uri: http://notificationService:8084
          predicates:
            - Path=/api/notifications/**
          filters:
            - StripPrefix=0

        # ═══════════════════════════════════════════════════════
        # MOTEL MANAGEMENT - RUTAS PÚBLICAS
        # ═══════════════════════════════════════════════════════

        # 6️⃣ Motels públicos
        - id: motel-management-motels
          uri: http://motel-management-service:8083
          predicates:
            - Path=/api/motels/**
          filters:
            - StripPrefix=0

        # 7️⃣ Rooms
        - id: motel-management-rooms
          uri: http://motel-management-service:8083
          predicates:
            - Path=/api/rooms/**
          filters:
            - StripPrefix=0

        # 8️⃣ Services
        - id: motel-management-services
          uri: http://motel-management-service:8083
          predicates:
            - Path=/api/services/**
          filters:
            - StripPrefix=0

        # 9️⃣ Reservations
        - id: motel-reservations
          uri: http://motel-management-service:8083
          predicates:
            - Path=/api/reservations/**
          filters:
            - StripPrefix=0

      trusted-proxies: '127\.0\.0\.1|::1'

# JWT Configuration
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}

# Logging
logging:
  level:
    com.example.gateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
    org.springframework.security: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics,gateway"
  endpoint:
    health:
      show-details: always